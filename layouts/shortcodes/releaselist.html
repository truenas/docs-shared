{{/* layouts/shortcodes/releaselist.html */}}
{{- $name := .Get "name" -}}
{{- $defaultTab := .Get "defaultTab" | default "2" | int -}}
{{- $productData := index .Site.Data.properties $name -}}
{{- with $productData }}
  <div class="gdoc-columns__content gdoc-markdown--nested flex-even">
    <div class="section-box section-box-schedule" id="{{ .id }}">
      <h2 class="section-box-header">Release Schedule</h2>

      {{- if .majorVersions }}
        {{- $adjustedDefaultTab := sub $defaultTab 1 -}}
        <div class="section-tabs" style="background-color: var(--accent-color);">
          {{- range $index, $majorVersion := .majorVersions }}
            {{- $isDefault := eq $index $adjustedDefaultTab -}}
            <div class="section-tab {{ $name }}-section-tab{{ if $isDefault }} active{{ end }}" onclick="showReleaseListVersion(this, '{{ $name }}', {{ $index }}); return false;">{{ $majorVersion.lifecycle }}</div>
          {{- end }}
        </div>

        {{- range $index, $majorVersion := .majorVersions }}
          {{- $isDefault := eq $index $adjustedDefaultTab -}}
          <div class="major-version-content {{ $name }}-major-version-content" id="{{ $name }}-majorVersion{{ $index }}" style="padding-left: 1.5rem; padding-right: 1.5rem; display: {{ if $isDefault }}block{{ else }}none{{ end }};">
            <p><b>{{ $majorVersion.name }}</b></p>

            {{- $latestEntries := where $majorVersion.releases "latest" true }}
            {{- $nonLatestEntries := where $majorVersion.releases "latest" false }}

            {{- if $latestEntries }}
              <b class="flex flex-wrap align-center gdoc-props__meta">
                Latest:
              </b>
              {{- range $latestEntries }}
                <dt class="flex flex-wrap align-center gdoc-props__meta" style="margin-left: .5rem;">
                  {{- if and (.link) (.name) }}
                    <a href="{{ .link }}" class="gdoc-props__title">{{ .name }}</a>
                  {{- else }}
                    <span class="gdoc-props__title">{{ .name }}</span>
                  {{- end }}

                  {{- with .type }}
                    <span class="gdoc-props__tag note" style="margin-left: 0.5rem;">{{ . }}</span>
                  {{- end }}

                  {{- if .releaseDate }}
                    <span class="gdoc-props__tag">{{ if or (eq .releaseDate "") (eq .releaseDate "TBD") }}TBD{{ else }}{{ dateFormat "2 January 2006" .releaseDate }}{{ end }}</span>
                  {{- end }}
                </dt>
                <dd style="margin-left: .5rem;">
                  <div class="gdoc-props__description">
                    {{- with .description }}
                      {{- $desc := . }}
                      {{- if reflect.IsMap $desc }}
                        {{- $desc = (index $desc $.Site.Language.Lang) }}
                      {{- end }}
                      {{ $desc | $.Page.RenderString }}
                    {{- end }}
                  </div>
                </dd>
              {{- end }}

              {{- if $nonLatestEntries }}
                <hr width="33%" style="margin: 1rem 0;">
              {{- end }}
            {{- end }}

            {{- if $nonLatestEntries }}
              <b class="flex flex-wrap align-center gdoc-props__meta">
                Anticipated:
              </b>
              {{- range $nonLatestEntries }}
                <dt class="flex flex-wrap align-center gdoc-props__meta" style="margin-left: .5rem;">
                  {{- if and (.link) (.name) }}
                    <a href="{{ .link }}" class="gdoc-props__title">{{ .name }}</a>
                  {{- else }}
                    <span class="gdoc-props__title">{{ .name }}</span>
                  {{- end }}

                  {{- with .type }}
                    <span class="gdoc-props__tag note">{{ . }}</span>
                  {{- end }}

                  {{- if .releaseDate }}
                    <span class="gdoc-props__tag">{{ if or (eq .releaseDate "") (eq .releaseDate "TBD") }}TBD{{ else }}{{ dateFormat "2 January 2006" .releaseDate }}{{ end }}</span>
                  {{- end }}
                </dt>
                <dd style="margin-left: .5rem;">
                  <div class="gdoc-props__description">
                    {{- with .description }}
                      {{- $desc := . }}
                      {{- if reflect.IsMap $desc }}
                        {{- $desc = (index $desc $.Site.Language.Lang) }}
                      {{- end }}
                      {{ $desc | $.Page.RenderString }}
                    {{- end }}
                  </div>
                </dd>
              {{- end }}
            {{- end }}
          </div>
        {{- end }}
      {{- end }}
    </div>
  </div>

  <script>
    if (!window.showReleaseListVersion) {
      window.showReleaseListVersion = function(clickedTab, shortcodeName, majorVersion) {
        var sectionBox = clickedTab.closest('.section-box');

        if (sectionBox) {
          // Hide all content for this shortcode within this section box
          var majorVersionContents = sectionBox.querySelectorAll('.' + shortcodeName + '-major-version-content');
          majorVersionContents.forEach(function(content) {
            content.style.display = 'none';
          });

          // Show selected content within this section box
          var selectedContent = sectionBox.querySelector('#' + shortcodeName + '-majorVersion' + majorVersion);
          if (selectedContent) {
            selectedContent.style.display = 'block';
            selectedContent.style.setProperty('display', 'block', 'important');
          }

          // Update active tab styling within this section box
          var tabs = sectionBox.querySelectorAll('.' + shortcodeName + '-section-tab');
          tabs.forEach(function(tab) {
            tab.classList.remove('active');
          });

          // Activate the clicked tab
          clickedTab.classList.add('active');
        }
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      var defaultTabIndex = {{ $defaultTab }} - 1;
      var majorVersionTabs = document.querySelectorAll('.{{ $name }}-section-tab');
      if (defaultTabIndex >= 0 && defaultTabIndex < majorVersionTabs.length) {
        majorVersionTabs[defaultTabIndex].click();
      }
    });
  </script>
{{- end }}
